{"title":"flutter_chat_system","slug":"flutter-chat-system","date":"2019-08-06T12:56:38.000Z","updated":"2019-08-06T14:55:35.228Z","comments":true,"path":"api/articles/flutter-chat-system.json","photos":[],"link":"","excerpt":null,"covers":["/2019/08/06/flutter-chat-system/chatListPage.gif"],"content":"<p>因为最近在从事FLutter的工作，所以还是有必要去做一些相关笔记的，FLutter的生态有待完善，尤其是集成第三方SDK，目前大多数第三方包都是没有给flutter提供<br>直接import集成方法的，但是好在flutter可以使用MethodChannel等方法来与底层进行通信，有助于我们更好的去集成，但是在此之前，你需要对flutter的dart和安卓的java有一定的了解，<br>不然就只能像我这样，黑夜中抓瞎。不多说了，写个聊天的小demo，目前只是实现基础的布局，可以先看一下效果。<br><img src=\"/2019/08/06/flutter-chat-system/chatListPage.gif\" alt><br>关于布局，其实没什么可以说的了，这是最基本的布局。因为表单这一块还没有思路，并没有展示出来。</p>\n<p>整个小demo是分了两个<code>.dart</code>文件的。<br><code>main.dart</code>入口函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &apos;package:flutter/material.dart&apos;;</span><br><span class=\"line\">import &apos;chatPage.dart&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">void main()=&gt; runApp(MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\">class MyApp extends StatelessWidget &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return MaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(&quot;聊天室&quot;),</span><br><span class=\"line\">          centerTitle: true,</span><br><span class=\"line\"></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: ChatList()</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class ChatList extends StatefulWidget &#123;</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _ChatListState createState() =&gt; _ChatListState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class _ChatListState extends State&lt;ChatList&gt; &#123;</span><br><span class=\"line\">  final title = &quot;花开不败&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return ListView.builder(</span><br><span class=\"line\">          itemCount: messageData.length,</span><br><span class=\"line\">          itemBuilder: (BuildContext context , int index)&#123;</span><br><span class=\"line\">            return InkWell(</span><br><span class=\"line\">              child: MessageItem(messageData[index]),</span><br><span class=\"line\">              onTap: ()&#123;</span><br><span class=\"line\">                print(index);</span><br><span class=\"line\">                Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; ChatPage()));</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">            );</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> class MessageData&#123;</span><br><span class=\"line\">   String avatar;</span><br><span class=\"line\">   String title;</span><br><span class=\"line\">   String chatContent;</span><br><span class=\"line\">   String time;</span><br><span class=\"line\">   MessageData(this.avatar,this.title,this.chatContent,this.time);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">List&lt;MessageData&gt; messageData = [</span><br><span class=\"line\">  MessageData(&quot;image/avatar.ico&quot;, &quot;花开不败&quot;, &quot;哈哈哈，我是你的聊天内容&quot;, &quot;17:45&quot;)</span><br><span class=\"line\">];</span><br><span class=\"line\">class MessageItem extends StatelessWidget &#123;</span><br><span class=\"line\">  final MessageData message ;</span><br><span class=\"line\">  MessageItem(this.message);</span><br><span class=\"line\">  final titleStyle = TextStyle(color: Colors.black,fontWeight: FontWeight.bold,fontSize: 18.0);</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return  Container(</span><br><span class=\"line\">      margin: const EdgeInsets.all(5),</span><br><span class=\"line\">      decoration: BoxDecoration(</span><br><span class=\"line\">        // border: Border.all(color: Colors.black,width: 2)</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      child: Row(</span><br><span class=\"line\">        children: &lt;Widget&gt;[</span><br><span class=\"line\">          Image.asset(message.avatar,width: 50,height: 50,),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            margin: const EdgeInsets.fromLTRB(15, 5, 5, 5),</span><br><span class=\"line\">            child: Column(</span><br><span class=\"line\">              crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class=\"line\">              children: &lt;Widget&gt;[</span><br><span class=\"line\">                Text(message.title,style: titleStyle,),</span><br><span class=\"line\">                Text(message.chatContent),</span><br><span class=\"line\">              ],</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Expanded(</span><br><span class=\"line\">            child: Container(</span><br><span class=\"line\">              margin: const EdgeInsets.fromLTRB(0, 0, 0, 20),</span><br><span class=\"line\">              decoration: BoxDecoration(</span><br><span class=\"line\">                // border: Border.all(color: Colors.red,width: 2.0)</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              alignment: Alignment.topRight,</span><br><span class=\"line\">              child: Text(message.time),</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是，关于列表这一块，不要盲目的去写，首先你应该知道，列表的数据一般都是服务端以一个对象的形式提供，对象内每一个数组都对应着每一个列表项，<br><code>flutter</code>也为我们提供了一个ListView.builder的构造方法，让我们去遍历每一个数组的数据，然后生成列表。因为我用的是假数据，如果在真实项目中，大家可以直接拿到对象，并赋值一个新的数组，<br>定义好与后台对应字段信息的变量，直接传参到封装好的布局组件内就可以了。</p>\n<p>然后是关于聊天消息的页面，我这边不确定第三方即时通讯SDK能够给我什么参数，假设了一下聊天消息，和user识别，以及对应user的头像。上一下代码。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &apos;package:flutter/material.dart&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">class ChatPage extends StatefulWidget &#123;</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  _ChatPageState createState() =&gt; _ChatPageState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class _ChatPageState extends State&lt;ChatPage&gt; &#123;</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(&quot;花开不败&quot;),</span><br><span class=\"line\">        centerTitle: true,</span><br><span class=\"line\">        leading: IconButton(</span><br><span class=\"line\">          icon: Icon(Icons.arrow_left),</span><br><span class=\"line\">          onPressed: ()&#123;</span><br><span class=\"line\">            Navigator.pop(context);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: ListView(</span><br><span class=\"line\">        children: &lt;Widget&gt;[</span><br><span class=\"line\">          ListView(</span><br><span class=\"line\">            shrinkWrap: true,</span><br><span class=\"line\">            physics: new NeverScrollableScrollPhysics(),</span><br><span class=\"line\">            children: &lt;Widget&gt;[</span><br><span class=\"line\">              chatMessageItem(&quot;image/avatar.ico&quot;,&quot;hai，你好啊&quot;,0),</span><br><span class=\"line\">              chatMessageItem(&quot;image/demo2.jpg&quot;,&quot;嗯嗯，你好呀&quot;,1),</span><br><span class=\"line\">              chatMessageItem(&quot;image/avatar.ico&quot;,&quot;嗯嗯，你好呀&quot;,0),</span><br><span class=\"line\">              chatMessageItem(&quot;image/demo2.jpg&quot;,&quot;嗯嗯，你好呀&quot;,1),</span><br><span class=\"line\">              chatMessageItem(&quot;image/avatar.ico&quot;,&quot;嗯嗯，你好呀&quot;,0),</span><br><span class=\"line\">              chatMessageItem(&quot;image/demo2.jpg&quot;,&quot;嗯嗯，你好呀&quot;,1),</span><br><span class=\"line\">              chatMessageItem(&quot;image/avatar.ico&quot;,&quot;嗯嗯，你好呀&quot;,0),</span><br><span class=\"line\">              chatMessageItem(&quot;image/demo2.jpg&quot;,&quot;咱也不敢说咱也不敢问咱也不敢说咱也不敢问咱也不敢说咱也不敢问咱也不敢说咱也不敢问&quot;,1),</span><br><span class=\"line\">              chatMessageItem(&quot;image/avatar.ico&quot;,&quot;嗯嗯，你好呀&quot;,0),</span><br><span class=\"line\">              chatMessageItem(&quot;image/demo2.jpg&quot;,&quot;咱也不敢说咱也不敢问咱也不敢说咱也不敢问咱也不敢说咱也不敢问咱也不敢说咱也不敢问&quot;,1),</span><br><span class=\"line\">                //这里不知道服务端能给我提供什么数组，所以只能自己伪造一些。</span><br><span class=\"line\">            ],</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Widget chatMessageItem(String avatar , String message , int user)&#123;</span><br><span class=\"line\">    return Container(</span><br><span class=\"line\">      margin: EdgeInsets.symmetric(horizontal: 10,vertical:10),</span><br><span class=\"line\">      child:Row(</span><br><span class=\"line\">        mainAxisAlignment: user == 0 ? MainAxisAlignment.start: MainAxisAlignment.end,</span><br><span class=\"line\">        children: &lt;Widget&gt;[</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">              child:user == 0 ?  CircleAvatar(</span><br><span class=\"line\">                backgroundImage: AssetImage(user == 0 ? avatar : &quot;&quot;),</span><br><span class=\"line\">              ):null</span><br><span class=\"line\"></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">              margin: EdgeInsets.only(left: 10,right: 10),</span><br><span class=\"line\">              width: MediaQuery.of(context).size.width/2,</span><br><span class=\"line\">              decoration: BoxDecoration(</span><br><span class=\"line\">                color: Colors.yellow,</span><br><span class=\"line\">                borderRadius: BorderRadius.only(</span><br><span class=\"line\">                    topLeft: Radius.circular(user == 0 ? 15 : 5),</span><br><span class=\"line\">                    topRight: Radius.circular(user == 1 ? 15 : 5),</span><br><span class=\"line\">                    bottomLeft: Radius.circular(5),</span><br><span class=\"line\">                    bottomRight: Radius.circular(5)</span><br><span class=\"line\">                ),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              child: Padding(</span><br><span class=\"line\">                child: Text(message,style: TextStyle(color: Colors.black,fontSize: 15),softWrap: true,maxLines: 50,),</span><br><span class=\"line\">                padding: EdgeInsets.symmetric(horizontal: 10,vertical: 10),</span><br><span class=\"line\">              )</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            child:user == 1 ?  CircleAvatar(</span><br><span class=\"line\">              backgroundImage: AssetImage(user == 1 ? avatar : &quot;&quot;),</span><br><span class=\"line\">            ):null</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>聊天消息 这一块布局也是没有什么大问题，问题都在后面的表单提交重新Build view层，以及第三方SDK的集成。</p>\n<p>未完待续<del>~</del></p>\n","categories":[],"tags":[{"name":"-Flutter","slug":"Flutter","count":4,"path":"api/tags/Flutter.json"}]}